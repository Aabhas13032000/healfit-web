<%- include('../components/header/header.ejs',{cssFile : 'index',page:page}) %> 

<div class="blurbackground" onclick="toggleSideBar()"></div>

<div class="navbar">
    <div class="container">
        <div class="logo">
            <a class="logo-item">
                <img src="/images/local/logo.png">
                HealFit
            </a>
        </div>
        <div class="menu">
            <ul>
                <li onclick="window.location.href = '/'">Home</li>
                <li onclick="window.location.href = '/programs'">Programs</li>
                <li onclick="window.location.href = '/experts'">Experts</li>
                <li onclick="window.location.href = '/blogs'">Blogs</li>
                <li onclick="window.location.href = '/about'">About us</li>
                <li onclick="window.location.href = '/contact'">Contact us</li>
            </ul>
        </div>
        <div class="button">
            <a href="#login" data-bs-toggle="modal" data-bs-target="#login">Login</a>
        </div>
        <div class="toggle-navbar">
            <a onclick="toggleSideBar()"><span class="iconify" data-icon="charm:menu-hamburger"></span></a>
        </div>
    </div>
</div>

<div class="sidebar">
    <ul>
        <li onclick="window.location.href = '/'">
            <a><span>Home</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
        <li onclick="window.location.href = '/programs'">
            <a><span>Programs</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
        <li onclick="window.location.href = '/experts'">
            <a><span>Experts</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
        <li onclick="window.location.href = '/blogs'">
            <a><span>Blogs</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
        <li onclick="window.location.href = '/about'">
            <a><span>About us</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
        <li onclick="window.location.href = '/contact'">
            <a><span>Contact us</span><span class="iconify" data-icon="charm:arrow-right"></span></a>
        </li>
    </ul>
    <div class="button">
        <a href="#login" data-bs-toggle="modal" data-bs-target="#login">Login</a>
    </div>
</div>

<div class="modal fade" id="login" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl">
        <div class="modal-content">
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12 col-12 order-1 order-md-0 d-none d-md-flex">
                        <div id="carouselExampleSlidesOnly" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-inner">
                              <div class="carousel-item active">
                                <img src="https://cdn.mos.cms.futurecdn.net/KLZwUWe4JwyyXY7pV7CpaU.jpg" class="d-block w-100" alt="">
                              </div>
                              <div class="carousel-item">
                                <img src="https://resize.indiatvnews.com/en/resize/newbucket/1200_-/2022/02/fitness-tips-1645774618.jpg" class="d-block w-100" alt="">
                              </div>
                              <div class="carousel-item">
                                <img src="https://static.wixstatic.com/media/6a670ac1508f442cac494d76770e1ded.jpg/v1/fill/w_640,h_452,al_t,q_80,usm_0.66_1.00_0.01,enc_auto/6a670ac1508f442cac494d76770e1ded.jpg" class="d-block w-100" alt="">
                              </div>
                            </div>
                          </div>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-12 col-12 order-0 order-md-1 d-flex justify-content-center align-items-center">
                        <div class="login_form">
                            <p>USER LOGIN</p>
                            <div id="phone_number_input">
                                <div class="form-group">
                                    <label for="phoneNumber" style="margin:0px 0px 10px 0px;">Phone number</label>
                                    <div class="input-group search">
                                        <a style="background-color: var(--card-bg);">+91</a>
                                        <input type="text" id="phoneNumber" name="phoneNumber" class="form-control" placeholder="Enter 10 digit phone number here.." maxlength="10" minlength="10" style="border-left: 0">
                                    </div>
                                </div>
                                <div class="button" style="margin:30px 0px 10px 0px;">
                                    <button id="sign-in-button" class="btn btn-primary" style="border: 0;width: 100%;">
                                        Get OTP
                                    </button>
                                </div>
                            </div>
                            <div id="otp_verification" style="display: none;">
                                <div class="form-group">
                                    <label for="phoneNumber" style="margin:0px 0px 10px 0px;">Phone number</label>
                                    <input type="text" class="form-control" id="code" placeholder="Enter OTP" maxlength="6" minlength="6" required/>
                                </div>
                                <div class="button" style="margin:30px 0px 10px 0px;">
                                    <button id="confirm-code" style="border: 0;width: 100%;" class="btn btn-primary">
                                        Verify
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="recaptcha-container" style="display: none"></div>
            </div>
        </div>
    </div>
  </div>

  <% if(page == 'Home') {%> 
    <%- include('main.ejs') %> 
  <% } %> 

  <% if(page == 'About') {%> 
    <%- include('about_us.ejs') %> 
  <% } %> 

  <% if(page == 'Blogs') {%> 
    <%- include('blogs.ejs') %> 
  <% } %> 

  <% if(page == 'Contact') {%> 
    <%- include('contact_us.ejs') %> 
  <% } %> 

  <% if(page == 'Experts') {%> 
    <%- include('experts.ejs') %> 
  <% } %> 

  <% if(page == 'Programs') {%> 
    <%- include('programs.ejs') %> 
  <% } %> 

  <% if(page == 'Privacy Policy') {%> 
    <%- include('privacy_policy.ejs') %> 
  <% } %> 

<script src="/javascripts/home.js"></script>
<script type="module">
    var loginModal;
    var reloadCount;
    var state;
    $(function(){
        // bootstraps modals
        loginModal = new bootstrap.Modal(document.getElementById('login'));
        state = history.state || {};
        reloadCount = state.reloadCount || 0;
        if (performance.navigation.type === 1) { // Reload
            state.reloadCount = ++reloadCount;
            history.replaceState(state, null, document.URL);
        } else if (reloadCount) {
            delete state.reloadCount;
            reloadCount = 0;
            history.replaceState(state, null, document.URL);
        }
    });
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-analytics.js";
  import { getAuth, RecaptchaVerifier,signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-auth.js";
  import { getMessaging, getToken } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-messaging.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA1emjLa2Hvq37jMYfEfzK26geu4bniV1E",
    authDomain: "healfit-smtp.firebaseapp.com",
    projectId: "healfit-smtp",
    storageBucket: "healfit-smtp.appspot.com",
    messagingSenderId: "583727872448",
    appId: "1:583727872448:web:e0af4962dbb1ae84a87025",
    measurementId: "G-LKJDW8T8Z2"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const messaging = getMessaging(app);
  await getToken(messaging,{vapidKey: "<%- firebaseKey %>"}).then((value)=>{
    // console.log('token generated=' + value);
    $.ajax({
            url : `/api/createUser/`,
            dataType: "json",
            type: "GET",
            headers: {
                'token':value,
                'Content-Type':'application/json',
                'platform': 'WEB'
            },
            success: function(response){
              if(isDevelopment) {
                    console.log(response);
                }
            //   console.log(window.location.pathname);
              if(response.user.length != 0){
                if(response.user[0].logged_in == 1){

                } else {
                    if(response.user[0].phoneNumber == '+910000000000'){
                        if(window.location.pathname == '/' && reloadCount <= 1){
                            setTimeout(() => {
                                loginModal.toggle();
                            },1000);
                        }
                    } else {
                        if(response.user[0].is_otp_verified == 1){
                            if(response.user[0].name == null || response.user[0].age == 0){
                                //Open name age modal 
                            }
                        } else {
                            loginModal.toggle();
                        }
                    }
                }
              }
            },
            error: function(err){
                if(isDevelopment) {
                    console.log(err);
                }
                alert('Some error occured !!');
            }
        });
  });


    const auth = getAuth();
    window.recaptchaVerifier = new RecaptchaVerifier(
        "recaptcha-container",
        {
            size: "invisible",
            callback: function(response) {
                submitPhoneNumberAuth();
            }
        },auth
    );

    let obj = document.getElementById('sign-in-button');
    obj.addEventListener("click", function(event) {
        event.preventDefault();
        submitPhoneNumberAuth();
    });

    function submitPhoneNumberAuth() {
        document.getElementById('sign-in-button').setAttribute('disabled','disabled');
        var phoneNumber = document.getElementById("phoneNumber").value;
            if(phoneNumber.length ==10) {
                var appVerifier = window.recaptchaVerifier;
                var a = '+91' + phoneNumber;
                signInWithPhoneNumber(auth,a, appVerifier)
                    .then(function(confirmationResult) {
                        window.confirmationResult = confirmationResult;
                        document.getElementById('phone_number_input').style.display="none";
                        document.getElementById('otp_verification').style.display="block";
                    })
                    .catch(function(error) {
                        console.log(error);
                        alert('Please enter a correct phone number');
                    });
            } else {
                alert('Please enter a correct phone number');
            }
    }

    let obj2 = document.getElementById('confirm-code');
    obj2.addEventListener("click", function(event) {
        event.preventDefault();
        submitPhoneNumberAuthCode();
    });

    function submitPhoneNumberAuthCode() {
        document.getElementById('confirm-code').setAttribute('disabled','disabled');
        var code = document.getElementById("code").value;
        if(code.length !=6){
            alert('Please enter a correct OTP');
        } else {
            confirmationResult
                .confirm(code)
                .then(function(result) {
                    var user = result.user;
                    console.log(user);
                })
                .catch(function(error) {
                    console.log(error);
                });
        }
    }

</script>

<%- include('../components/footer/footer.ejs') %>